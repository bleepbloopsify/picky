{% extends "master.html" %}

{% block body %}
    <div class="home-contain">
      {{ nav() }}
      <div class="addr-box">
        <input name="address" type = "text" class="address-home">
        <button id="addr" class="address-button" ><span class="glyphicon glyphicon-search"</button>
      </div>
    </div>
    <div class="arrow-down">
      <span id="arrow" class="glyphicon glyphicon-menu-down"></span>
    </div>
    <hr class="seperate">
    <div class="about-contain">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-4">
            <div class="about-text">
              <span class="glyphicon glyphicon-heart"></span>
              <p>
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer at ante erat. Etiam porttitor tristique erat. Duis et turpis vel augue consequat imperdiet vitae non diam. Integer augue neque, congue sit amet sollicitudin non, volutpat a enim. Sed congue sagittis arcu nec imperdiet. Aenean bibendum sed justo in sollicitudin. Proin vestibulum dolor et velit condimentum accumsan. Aenean auctor congue pharetra. Ut pellentesque suscipit elit, non tincidunt leo porttitor eu. Praesent luctus, quam ac volutpat semper, augue orci pellentesque orci, in malesuada erat sem eget mi. Maecenas erat orci, ullamcorper eu ex at, faucibus vehicula libero. Nunc suscipit mattis sem at elementum.
              </p>
            </div>
          </div>
          <div class="col-md-4">
            <div id="scroll-to" class="about-text">
              <span class="glyphicon glyphicon-cutlery"></span>
              <p>
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer at ante erat. Etiam porttitor tristique erat. Duis et turpis vel augue consequat imperdiet vitae non diam. Integer augue neque, congue sit amet sollicitudin non, volutpat a enim. Sed congue sagittis arcu nec imperdiet. Aenean bibendum sed justo in sollicitudin. Proin vestibulum dolor et velit condimentum accumsan. Aenean auctor congue pharetra. Ut pellentesque suscipit elit, non tincidunt leo porttitor eu. Praesent luctus, quam ac volutpat semper, augue orci pellentesque orci, in malesuada erat sem eget mi. Maecenas erat orci, ullamcorper eu ex at, faucibus vehicula libero. Nunc suscipit mattis sem at elementum.
              </p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="about-text">
              <span class="glyphicon glyphicon-search"></span>
              <p>
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer at ante erat. Etiam porttitor tristique erat. Duis et turpis vel augue consequat imperdiet vitae non diam. Integer augue neque, congue sit amet sollicitudin non, volutpat a enim. Sed congue sagittis arcu nec imperdiet. Aenean bibendum sed justo in sollicitudin. Proin vestibulum dolor et velit condimentum accumsan. Aenean auctor congue pharetra. Ut pellentesque suscipit elit, non tincidunt leo porttitor eu. Praesent luctus, quam ac volutpat semper, augue orci pellentesque orci, in malesuada erat sem eget mi. Maecenas erat orci, ullamcorper eu ex at, faucibus vehicula libero. Nunc suscipit mattis sem at elementum.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="filter-contain">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-6 col-md-offset-3">
            <div class="col-md-6 col-sm-12">
              <div class="distance-contain">
                <p>Max Distance</p>
                <div id="distance">
                  <span id="distance-value"></span>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-sm-12">
              <div class="rating-contain">
                <p>Lowest Rating</p>
                <div class="star">
                  <div>
                    <span id="star-5" class="rating">☆</span><span id="star-4" class="rating">☆</span><span id="star-3" class="rating">☆</span><span id="star-2" class="rating">☆</span><span id="star-1" class="rating">☆</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 col-md-offset-3">
            <div class="type-list">
              <div class="row" id="results">

              <!-- <div class="row restaurant-list">
                <div class="col-md-3 restaurant-list">
                  <button class="restaurant-type selected"> Chinese </button>
                </div>
                <div class="col-md-3 restaurant-list">
                  <button class="restaurant-type selected"> Chinese </button>
                </div>
                <div class="col-md-3 restaurant-list">
                  <button class="restaurant-type selected"> Chinese </button>
                </div>
                <div class="col-md-3 restaurant-list">
                  <button class="restaurant-type selected"> Chinese </button>
                </div>
              </div>
              <div class="row">
                <div class="col-md-3 restaurant-list">
                  <button class="restaurant-type selected"> Chinese </button>
                </div>
                <div class="col-md-3 restaurant-list">
                  <button class="restaurant-type selected"> Chinese </button>
                </div>
                <div class="col-md-3 restaurant-list">
                  <button class="restaurant-type selected"> Chinese </button>
                </div>
                <div class="col-md-3 restaurant-list">
                  <button class="restaurant-type selected"> Chinese </button>
                </div>
              </div> -->
              </div>
            </div>
            <button id="sendFilter">Search</button>
          </div>
        </div>
      </div>
    </div>
    <div class="login">
      <button id="exit-log" class="exit">x</button>
      <h1 class="login-title">Login</h1>
      <h3 class="login-msg">Don't have an account? <a id="screen-reg" href="#">Register</a> here.</h3>
      <h3 class="error-message">{{error}}</h3>
      <form class="login-form" method="post">
        <p>Username:</p>
        <input type="text" name="user">
        <p>Password:</p>
        <input type="password" name="pwd">
        <button type="submit">Login</button>
      </form>
    </div>
    <div class="register">
      <button id="exit-reg" class="exit">x</button>
      <h1 class="login-title">Register</h1>
      <h3 class="login-msg">Already have an account? <a id="screen-log" href="#">Login</a> here.</h3>
      <h3 class="error-message">{{err}}</h3>
      <form class="login-form" method="POST">
        <p>Username:</p>
        <input type="text" name="user">
        <p>Password:</p>
        <input type="password" name="pwd">
        <p>Confirm Password:</p>
        <input type="password" name="pwd2">
        <button type="submit">Register</button>
      </form>
    </div>
    <div class="cover">
    </div>

    <script>
      var stars = 0;
      var enters = 0;
      $(document).on("click", "#star-1", function(){
        if ($("#star-1")) {
          $(id).removeClass("rating-select");
          $(id).addClass("rating");
        }
        for (var i = 5; i > 1; i--) {
          var id = "#star-" + i;
          $(id).removeClass("rating-select");
          $(id).addClass("rating");
        }
        $("#star-1").addClass("rating-select");
        $("star-1").removeClass("rating");
        stars = 1;
      });
      $(document).on("click", "#star-2", function(){
        for (var i = 5; i > 2; i--) {
          var id = "#star-" + i;
          $(id).removeClass("rating-select");
          $(id).addClass("rating");
        }
        for (var i = 0; i < 2; i++) {
          var id = "#star-" + (i + 1);
          $(id).addClass("rating-select");
          $(id).removeClass("rating");
        }
        stars = 2;
      });
      $(document).on("click", "#star-3", function(){
        for (var i = 5; i > 3; i--) {
          var id = "#star-" + i;
          $(id).removeClass("rating-select");
          $(id).addClass("rating");
        }
        for (var i = 0; i < 3; i++) {
          var id = "#star-" + (i + 1);
          $(id).addClass("rating-select");
          $(id).removeClass("rating");
        }
        stars = 3;
      });
      $(document).on("click", "#star-4", function(){
        for (var i = 5; i > 4; i--) {
          var id = "#star-" + i;
          $(id).removeClass("rating-select");
          $(id).addClass("rating");
        }
        for (var i = 0; i < 4; i++) {
          var id = "#star-" + (i + 1);
          $(id).addClass("rating-select");
          $(id).removeClass("rating");
        }
        stars = 4;
      });
      $(document).on("click", "#star-5", function(){
        for (var i = 0; i < 5; i++) {
          var id = "#star-" + (i + 1);
          $(id).addClass("rating-select");
          $(id).removeClass("rating");
        }
        stars = 5;
      });
      $( "#distance" ).slider( {
        value: 25,
        max: 25,
        change : function() {
          var label = $('#distance-value');
          label.text($('#distance').slider('value') + " miles");
          var string = $('#distance').text();
          label.css('left', (parseInt(string.substring(0,string.length - 8)) - 1) * 8 - 15);
        },
        slide : function() {
          var label = $('#distance-value');
          label.text($('#distance').slider('value') + " miles");
          var string = $('#distance').text();
          label.css('left', (parseInt(string.substring(0,string.length - 8)) - 1) * 8 - 15);
        }
      });
      $(document).ready(function() {
        var label = $('#distance-value');
        label.text($('#distance').slider('value') + " miles");
        var string = $('#distance').text();
        label.css('left', (parseInt(string.substring(0,string.length - 8)) - 1) * 8 - 15);
        var opt = $('#distance').data().uiSlider.options;
        var el = $('<label>' + 0 + '</label>').addClass("distance-label-1");
        var el2 = $('<label>' + 5 + '</label>').addClass("distance-label-2");
        var el3 = $('<label>' + 10 + '</label>').addClass("distance-label-3");
        var el4 = $('<label>' + 15 + '</label>').addClass("distance-label-4");
        var el5 = $('<label>' + 20 + '</label>').addClass("distance-label-5");
        var el6 = $('<label>' + 25 + '</label>').addClass("distance-label-6");
        $("#distance").append(el);
        $("#distance").append(el2);
        $("#distance").append(el3);
        $("#distance").append(el4);
        $("#distance").append(el5);
        $("#distance").append(el6);
        $(".address-home").focus();
        $(".cover").height($(document).height());
      });
      $(function() {
       $('#addr').bind('click', function() {
         if (enters++ < 1) {
           $.getJSON('/results', {
             addr: $('input[name="address"]').val()
           }, function(data) {
             var data = data.result;
             $(".about-contain").css("display", "none");
             $(".filter-contain").css("display", "block");
             for (var i = 0; i < data.length; i++){
               $("#results").append('<div class="col-md-3 col-sm-4 col-xs-6 restaurant-list"><button class="restaurant-type selected">' + data[i] + '</button></div>');
             }
           });
           $('html, body').animate({
             scrollTop: ($('#scroll-to').offset().top)
           },500);
         }
         return false;
       });
     });
     $(document).on("click", ".restaurant-type", function(){
       if($(this).hasClass("selected")) {
         $(this).removeClass("selected");
       }
       else {
         $(this).addClass("selected");
       }
     });
     $("input").keypress(function(event) {
        if (event.which == 13) {
          event.preventDefault();
          if (enters++ < 1) {
            $.getJSON('/results', {
              addr: $('input[name="address"]').val()
            }, function(data) {
              var data = data.result;
              $(".about-contain").css("display", "none");
              $(".filter-contain").css("display", "block");
              for (var i = 0; i < data.length; i++){
                $("#results").append('<div class="col-md-3 col-sm-4 col-xs-6 restaurant-list"><button class="restaurant-type selected">' + data[i] + '</button></div>');
              }
            });
            $('html, body').animate({
              scrollTop: ($('#scroll-to').offset().top)
            },500);
          }
        }
      });
      var getUrlParameter = function getUrlParameter(sParam) {
        var sPageURL = decodeURIComponent(window.location.search.substring(1)),
            sURLVariables = sPageURL.split('&'),
            sParameterName,
            i;

        for (i = 0; i < sURLVariables.length; i++) {
          sParameterName = sURLVariables[i].split('=');

          if (sParameterName[0] === sParam) {
              return sParameterName[1] === undefined ? true : sParameterName[1];
          }
        }
      };
      $(document).on("click", "#sendFilter", function(){
        var sendString = $('input[name="address"]').val() + ";";
        var restaurants = "";
        $('.restaurant-type').each(function(i, obj) {
          if (!$(obj).hasClass("selected")) {
            restaurants += $(obj).text() + ",";
          }
        });
        sendString+= $('#distance').slider('value') + ";";
        sendString+= stars + ";";
        sendString+=restaurants;
        var url = '/restaurants';
        var form = $('<form style="display:none" action="' + url + '" method="post">' + '<input type="text" name="details" value="' + sendString + '" />' +'</form>');
        $('body').append(form);
        form.submit();
      });
      $(document).on("click", "#login", function(){
        $(".login").css("display", "block");
        $(".cover").css("display", "block");
      });
      $(document).on("click", "#register", function(){
        $(".register").css("display", "block");
        $(".cover").css("display", "block");
      });
      $(document).on("click", "#exit-log", function(){
        $(".login").css("display", "none");
        $(".cover").css("display", "none");
      });
      $(document).on("click", "#exit-reg", function(){
        $(".register").css("display", "none");
        $(".cover").css("display", "none");
      });
      $(document).on("click", "#screen-log", function(){
        $(".login").css("display", "block");
        $(".register").css("display", "none");
        $(".cover").css("display", "block");
      });
      $(document).on("click", "#screen-reg", function(){
        $(".login").css("display", "none");
        $(".register").css("display", "block");
        $(".cover").css("display", "block");
      });
      $(document).on("click", "#arrow", function(){
        $('html, body').animate({
          scrollTop: ($('#scroll-to').offset().top)
        },500);
      });
    </script>
{% endblock %}
